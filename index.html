<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Andry Backbone Store</title>
    <style>
        :root { --primary: #ee4d2d; --dark: #2c3e50; --light: #f4f7f6; --success: #25d366; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--light); margin: 0; padding-bottom: 100px; color: #333; }
        
        header { background: var(--dark); color: white; text-align: center; padding: 15px; cursor: pointer; }
        
        /* Katalog View */
        .container { max-width: 1000px; margin: auto; padding: 10px; display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; }
        .card { background: white; border-radius: 8px; overflow: hidden; box-shadow: 0 2px 4px rgba(0,0,0,0.05); display: flex; flex-direction: column; border: 1px solid #eee; text-decoration: none; color: inherit; }
        .card img { width: 100%; aspect-ratio: 1 / 1; object-fit: cover; }
        .card-body { padding: 8px; flex-grow: 1; }
        .card-body h3 { font-size: 0.85rem; margin: 0; height: 2.4em; overflow: hidden; }
        .price { color: var(--primary); font-weight: bold; font-size: 0.95rem; margin: 5px 0; }

        /* Detail View */
        #detail-view { display: none; max-width: 600px; margin: auto; background: white; min-height: 100vh; padding-bottom: 50px; }
        .btn-back { padding: 15px; display: inline-block; cursor: pointer; color: var(--primary); font-weight: bold; }
        .detail-img { width: 100%; aspect-ratio: 1/1; object-fit: cover; }
        .detail-info { padding: 20px; }
        .detail-desc { line-height: 1.6; color: #555; white-space: pre-line; margin-top: 15px; border-top: 1px solid #eee; padding-top: 15px; }

        /* Cart Bar */
        .cart-bar { position: fixed; bottom: 0; width: 100%; background: white; padding: 15px; box-shadow: 0 -2px 10px rgba(0,0,0,0.1); display: flex; justify-content: space-between; align-items: center; box-sizing: border-box; }
        .btn-add-large { background: var(--primary); color: white; border: none; padding: 12px 25px; border-radius: 5px; font-weight: bold; cursor: pointer; width: 100%; }
        .btn-wa { background: var(--success); color: white; padding: 12px 20px; border-radius: 5px; text-decoration: none; font-weight: bold; }

        @media (min-width: 600px) { .container { grid-template-columns: repeat(4, 1fr); } }
    </style>
</head>
<body>

<header onclick="window.location.href='index.html'">
    <h1>üõ†Ô∏è Andry Backbone Store</h1>
</header>

<div id="catalog-view">
    <div class="container" id="produk-list">
        <p style="text-align:center; grid-column: 1/-1;">Memuat produk...</p>
    </div>
</div>

<div id="detail-view">
    <div class="btn-back" onclick="tampilkanKatalog()">‚Üê Kembali ke Katalog</div>
    <img id="main-img" class="detail-img" src="">
    <div class="detail-info">
        <h2 id="main-nama"></h2>
        <div id="main-harga" class="price" style="font-size: 1.5rem;"></div>
        <div id="main-desc" class="detail-desc"></div>
        <br>
        <button id="btn-tambah" class="btn-add-large"> Tambah ke Keranjang</button>
    </div>
</div>

<div class="cart-bar" id="cart-footer">
    <div id="cart-status">
        <small>Total Belanja:</small><br>
        <strong id="total-txt" style="color:var(--primary)">Rp 0</strong>
    </div>
    <a href="#" class="btn-wa" onclick="kirimWA()">Checkout WA</a>
</div>

<script>
    const linkGSheet = "https://docs.google.com/spreadsheets/d/e/2PACX-1vRtNoerhDtHch7TNHVbItg23RG4nneoZ8hv5MBR1Cr40iU5alO8a2O4EUR90YgleMH4-E-6zGJsEgcN/pub?output=csv";
    const nomorWA = "628123456789"; 
    let semuaProduk = [];
    let keranjang = [];

    async function init() {
        const response = await fetch(linkGSheet);
        const data = await response.text();
        const rows = data.split("\n").slice(1);
        
        semuaProduk = rows.map((row, index) => {
            const col = row.split(",");
            return { id: index, nama: col[0], harga: parseInt(col[1]), kategori: col[2], foto: col[3], desc: col[4] };
        });

        renderKatalog();
        
        // Cek jika URL punya parameter ID (misal: index.html?id=0)
        const urlParams = new URLSearchParams(window.location.search);
        if(urlParams.has('id')) {
            tampilkanDetail(urlParams.get('id'));
        }
    }

    function renderKatalog() {
        const list = document.getElementById('produk-list');
        list.innerHTML = "";
        semuaProduk.forEach(p => {
            list.innerHTML += `
                <div class="card" onclick="updateURL(${p.id})">
                    <img src="${p.foto}">
                    <div class="card-body">
                        <h3>${p.nama}</h3>
                        <div class="price">Rp ${p.harga.toLocaleString('id-ID')}</div>
                    </div>
                </div>`;
        });
    }

    function updateURL(id) {
        const newurl = window.location.protocol + "//" + window.location.host + window.location.pathname + '?id=' + id;
        window.history.pushState({path:newurl},'',newurl);
        tampilkanDetail(id);
    }

    function tampilkanDetail(id) {
        const p = semuaProduk[id];
        if(!p) return;
        
        document.getElementById('catalog-view').style.display = 'none';
        document.getElementById('detail-view').style.display = 'block';
        window.scrollTo(0,0);

        document.getElementById('main-img').src = p.foto;
        document.getElementById('main-nama').innerText = p.nama;
        document.getElementById('main-harga').innerText = "Rp " + p.harga.toLocaleString('id-ID');
        document.getElementById('main-desc').innerText = p.desc;
        
        document.getElementById('btn-tambah').onclick = () => {
            keranjang.push(p);
            updateCart();
            alert("Berhasil ditambah!");
        };
    }

    function tampilkanKatalog() {
        const cleanURL = window.location.protocol + "//" + window.location.host + window.location.pathname;
        window.history.pushState({path:cleanURL},'',cleanURL);
        document.getElementById('catalog-view').style.display = 'block';
        document.getElementById('detail-view').style.display = 'none';
    }

    function updateCart() {
        const total = keranjang.reduce((sum, item) => sum + item.harga, 0);
        document.getElementById('total-txt').innerText = "Rp " + total.toLocaleString('id-ID');
    }

    function kirimWA() {
        if(keranjang.length === 0) return alert("Keranjang masih kosong");
        const teks = keranjang.map(i => `- ${i.nama}`).join("\n");
        const total = keranjang.reduce((sum, item) => sum + item.harga, 0);
        const pesan = `Halo Andry Backbone, saya mau pesan:\n\n${teks}\n\nTotal: Rp ${total.toLocaleString('id-ID')}`;
        window.open(`https://wa.me/${nomorWA}?text=${encodeURIComponent(pesan)}`);
    }

    init();
</script>
</body>
</html>
