<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Andry Backbone Store - Pro</title>
    <style>
        :root { --primary: #ee4d2d; --dark: #212121; --gray: #757575; --bg: #f5f5f5; --success: #25d366; }
        body { font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif; background: var(--bg); margin: 0; padding-bottom: 80px; color: #333; }
        
        /* Navbar */
        nav { background: white; padding: 15px; position: sticky; top: 0; z-index: 1000; box-shadow: 0 1px 10px rgba(0,0,0,0.1); display: flex; align-items: center; }
        .back-icon { font-size: 24px; cursor: pointer; margin-right: 15px; color: var(--primary); }
        .nav-title { font-weight: bold; font-size: 1.1rem; flex-grow: 1; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }

        /* Katalog View */
        .catalog-container { max-width: 1000px; margin: auto; padding: 10px; display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; }
        .card { background: white; border-radius: 4px; overflow: hidden; text-decoration: none; color: inherit; display: flex; flex-direction: column; }
        .card img { width: 100%; aspect-ratio: 1 / 1; object-fit: cover; }
        .card-info { padding: 10px; flex-grow: 1; }
        .card-info h3 { font-size: 0.85rem; margin: 0; height: 2.4em; overflow: hidden; font-weight: normal; line-height: 1.3; }
        .card-price { color: var(--primary); font-weight: bold; font-size: 1rem; margin-top: 8px; }

        /* Detail View */
        #detail-view { display: none; background: var(--bg); min-height: 100vh; }
        .product-main { background: white; margin-bottom: 10px; }
        .detail-img { width: 100%; aspect-ratio: 1 / 1; object-fit: cover; }
        .detail-header { padding: 15px; background: white; }
        .detail-price { font-size: 1.6rem; color: var(--primary); font-weight: bold; margin-bottom: 10px; }
        .detail-title { font-size: 1.1rem; line-height: 1.4; margin: 0; font-weight: 500; }
        
        .product-desc { background: white; padding: 15px; margin-top: 10px; }
        .desc-title { font-weight: bold; margin-bottom: 10px; border-left: 4px solid var(--primary); padding-left: 10px; }
        .desc-text { font-size: 0.95rem; color: #555; line-height: 1.6; white-space: pre-line; }

        /* Bottom Bar (Beli) */
        .bottom-action { position: fixed; bottom: 0; width: 100%; background: white; border-top: 1px solid #ddd; padding: 10px 15px; display: flex; gap: 10px; box-sizing: border-box; }
        .btn-cart { flex: 1; border: 1px solid var(--primary); color: var(--primary); background: #fff5f1; padding: 12px; border-radius: 4px; font-weight: bold; cursor: pointer; }
        .btn-buy { flex: 1; background: var(--primary); color: white; border: none; padding: 12px; border-radius: 4px; font-weight: bold; cursor: pointer; }

        /* Badge Keranjang */
        #cart-count { background: var(--primary); color: white; font-size: 10px; padding: 2px 6px; border-radius: 10px; position: absolute; top: 10px; right: 10px; }

        @media (min-width: 600px) { .catalog-container { grid-template-columns: repeat(4, 1fr); } }
    </style>
</head>
<body>

<nav id="navbar">
    <span class="back-icon" id="btn-back" style="display:none;" onclick="tampilkanKatalog()">‚Üê</span>
    <span class="nav-title" id="nav-text">Andry Backbone Store</span>
    <div onclick="window.scrollTo(0, document.body.scrollHeight)" style="position: relative; cursor:pointer;">
        üõí<span id="cart-count">0</span>
    </div>
</nav>

<div id="catalog-view">
    <div class="catalog-container" id="produk-list">
        <p style="text-align:center; grid-column: 1/-1;">Sedang memuat...</p>
    </div>
</div>

<div id="detail-view">
    <div class="product-main">
        <img id="main-img" class="detail-img" src="">
        <div class="detail-header">
            <div id="main-price" class="detail-price"></div>
            <h1 id="main-title" class="detail-title"></h1>
        </div>
    </div>
    
    <div class="product-desc">
        <div class="desc-title">Deskripsi Produk</div>
        <div id="main-desc" class="desc-text"></div>
    </div>
</div>

<div class="bottom-action">
    <button class="btn-cart" onclick="tambahKeKeranjang()">+ Keranjang</button>
    <button class="btn-buy" onclick="checkoutWA()">Beli Sekarang</button>
</div>

<script>
    const linkGSheet = "https://docs.google.com/spreadsheets/d/e/2PACX-1vRtNoerhDtHch7TNHVbItg23RG4nneoZ8hv5MBR1Cr40iU5alO8a2O4EUR90YgleMH4-E-6zGJsEgcN/pub?output=csv";
    const nomorWA = "628123456789"; 
    let semuaProduk = [];
    let produkAktif = null;
    let keranjang = [];

    async function init() {
        const response = await fetch(linkGSheet);
        const data = await response.text();
        const rows = data.split("\n").slice(1);
        
        semuaProduk = rows.map((row, index) => {
            const col = row.split(",");
            return { id: index, nama: col[0], harga: parseInt(col[1]), kategori: col[2], foto: col[3], desc: col[4] };
        });

        renderKatalog();
        
        const urlParams = new URLSearchParams(window.location.search);
        if(urlParams.has('id')) tampilkanDetail(urlParams.get('id'));
    }

    function renderKatalog() {
        const list = document.getElementById('produk-list');
        list.innerHTML = "";
        semuaProduk.forEach(p => {
            list.innerHTML += `
                <div class="card" onclick="updateURL(${p.id})">
                    <img src="${p.foto}">
                    <div class="card-info">
                        <h3>${p.nama}</h3>
                        <div class="card-price">Rp ${p.harga.toLocaleString('id-ID')}</div>
                    </div>
                </div>`;
        });
    }

    function updateURL(id) {
        const newurl = window.location.protocol + "//" + window.location.host + window.location.pathname + '?id=' + id;
        window.history.pushState({path:newurl},'',newurl);
        tampilkanDetail(id);
    }

    function tampilkanDetail(id) {
        produkAktif = semuaProduk[id];
        if(!produkAktif) return;
        
        document.getElementById('catalog-view').style.display = 'none';
        document.getElementById('detail-view').style.display = 'block';
        document.getElementById('btn-back').style.display = 'block';
        document.getElementById('nav-text').innerText = "Detail Produk";
        window.scrollTo(0,0);

        document.getElementById('main-img').src = produkAktif.foto;
        document.getElementById('main-title').innerText = produkAktif.nama;
        document.getElementById('main-price').innerText = "Rp " + produkAktif.harga.toLocaleString('id-ID');
        document.getElementById('main-desc').innerText = produkAktif.desc;
    }

    function tampilkanKatalog() {
        const cleanURL = window.location.protocol + "//" + window.location.host + window.location.pathname;
        window.history.pushState({path:cleanURL},'',cleanURL);
        document.getElementById('catalog-view').style.display = 'block';
        document.getElementById('detail-view').style.display = 'none';
        document.getElementById('btn-back').style.display = 'none';
        document.getElementById('nav-text').innerText = "Andry Backbone Store";
        produkAktif = null;
    }

    function tambahKeKeranjang() {
        if(!produkAktif) return alert("Pilih produk dulu!");
        keranjang.push(produkAktif);
        document.getElementById('cart-count').innerText = keranjang.length;
        alert("Dimasukkan ke keranjang!");
    }

    function checkoutWA() {
        let listPesan = "";
        let total = 0;

        if(produkAktif && keranjang.length === 0) {
            // Jika langsung klik beli dari halaman detail tanpa isi keranjang
            listPesan = `- ${produkAktif.nama}`;
            total = produkAktif.harga;
        } else if (keranjang.length > 0) {
            listPesan = keranjang.map(i => `- ${i.nama}`).join("\n");
            total = keranjang.reduce((sum, item) => sum + item.harga, 0);
        } else {
            return alert("Keranjang kosong!");
        }

        const pesan = `Halo Andry Backbone, saya mau order:\n\n${listPesan}\n\nTotal: Rp ${total.toLocaleString('id-ID')}`;
        window.open(`https://wa.me/${nomorWA}?text=${encodeURIComponent(pesan)}`);
    }

    init();
</script>
</body>
</html>
